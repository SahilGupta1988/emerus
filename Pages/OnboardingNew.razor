@page "/onboarding/new"

<PageTitle>New Contractor</PageTitle>

<div class="page-header">
    <h2>New Contractor</h2>
    <p class="text-muted">Enter contractor details and onboarding requirements.</p>
</div>

<div class="card mt-3">
    <div class="card-body">
        <ul class="nav nav-pills mb-3 wizard-steps">
            @for (int i = 0; i < Steps.Count; i++)
            {
                var step = Steps[i];
                var active = i == CurrentStepIndex ? "active" : "";
                <li class="nav-item">
                    <button type="button"
                            class="nav-link @active"
                            disabled="@(i > MaxStepIndex)"
                            @onclick="(() => GoToStep(i))">
                        <span class="step-number">@((i + 1).ToString())</span> @step
                    </button>
                </li>
            }
        </ul>

        @switch (CurrentStepIndex)
        {
            case 0:
                <DemographicsStep Model="Demographics" />
                break;
            case 1:
                <JobStep Model="JobInfo" />
                break;
            case 2:
                <AccessStep Model="AccessInfo" />
                break;
            case 3:
                <HardwareStep Model="Hardware" />
                break;
            case 4:
                <BadgeStep Model="Badge" />
                break;
            case 5:
                <ComplianceStep />
                break;
            case 6:
                <ReviewStep Demographics="Demographics"
                            JobInfo="JobInfo"
                            AccessInfo="AccessInfo"
                            Hardware="Hardware"
                            Badge="Badge" />
                break;
        }

        <div class="d-flex justify-content-between mt-4">
            <button class="btn btn-outline-secondary" @onclick="Previous" disabled="@(CurrentStepIndex == 0)">Back</button>
            <div>
                <button class="btn btn-secondary me-2" @onclick="SaveDraft">Save Draft</button>
                @if (CurrentStepIndex < Steps.Count - 1)
                {
                    <button class="btn btn-primary" @onclick="Next">Next</button>
                }
                else
                {
                    <button class="btn btn-success" @onclick="Submit">Submit</button>
                }
            </div>
        </div>
    </div>
</div>

@code {
    private List<string> Steps = new()
    {
        "Demographics",
        "Job & Dates",
        "Access",
        "Hardware",
        "Badge",
        "Compliance",
        "Review"
    };

    private int CurrentStepIndex { get; set; } = 0;
    private int MaxStepIndex { get; set; } = 0;

    private DemographicsModel Demographics { get; set; } = new();
    private JobModel JobInfo { get; set; } = new();
    private AccessModel AccessInfo { get; set; } = new();
    private HardwareModel Hardware { get; set; } = new();
    private BadgeModel Badge { get; set; } = new();

    void GoToStep(int i)
    {
        if (i <= MaxStepIndex)
        {
            CurrentStepIndex = i;
        }
    }

    void Next()
    {
        if (CurrentStepIndex < Steps.Count - 1)
        {
            CurrentStepIndex++;
            if (CurrentStepIndex > MaxStepIndex)
            {
                MaxStepIndex = CurrentStepIndex;
            }
        }
    }

    void Previous()
    {
        if (CurrentStepIndex > 0)
        {
            CurrentStepIndex--;
        }
    }

    void SaveDraft()
    {
        // TODO: Hook up to backend
    }

    void Submit()
    {
        // TODO: Persist and redirect
    }

    public class DemographicsModel
    {
        public string FirstName { get; set; } = string.Empty;
        public string LastName  { get; set; } = string.Empty;
        public string PersonalEmail { get; set; } = string.Empty;
    }

    public class JobModel
    {
        public string JobTitle { get; set; } = string.Empty;
        public string Department { get; set; } = string.Empty;
        public DateTime StartDate { get; set; } = DateTime.Today;
    }

    public class AccessModel
    {
        public List<string> RequestedTargets { get; set; } = new();
    }

    public class HardwareModel
    {
        public bool NeedsLaptop { get; set; } = true;
        public bool NeedsDock { get; set; } = true;
        public int MonitorCount { get; set; } = 2;
    }

    public class BadgeModel
    {
        public bool NeedsBadge { get; set; } = true;
    }
}
